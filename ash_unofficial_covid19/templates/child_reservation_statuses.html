{% extends 'layout.html' %}
{% block content %}
<article id="childReservationStatus">
  <h1 class="h4">旭川市の新型コロナワクチン5～11歳接種医療機関マップ</h1>
  <div class="alert alert-danger alert-dismissible fade show mt-3" role="alert">
    <p class="mb-0">{{ last_updated }}にダウンロードしたデータを元に表示しています。正確な情報は必ず<a class="alert-link"
        href="https://asahikawa-vaccine.jp/" title="旭川市 新型コロナワクチン接種特設サイト"
        target="_blank">旭川市 新型コロナワクチン接種特設サイト <i class="fas fa-external-link-alt"></i></a>を確認してください。</p>
    <button type="button" class="close" data-dismiss="alert" aria-label="close">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="card mt-3">
    <div class="card-body">
      <section id="allMap">
        <h2 class="h5 card-title">地図から探す</h2>
        <p class="card-text">地図のポップアップのリンクから新型コロナワクチン5～11歳接種医療機関の予約受付状況を確認できます。（地図の表示はあくまで目安ですので、正確な場所の情報は各医療機関のホームページ等でご確認ください。）</p>
        <div id="mapid" class="mb-3"></div>
        <p class="card-text small">医療機関の位置情報は、<a href="https://developer.yahoo.co.jp/webapi/map/"
            title="Yahoo! Open Local Platform" target="_blank">Yahoo! Open Local Platform (YOLP)
          </a>のYahoo!ローカルサーチAPIを使用して取得しています。
          <!-- Begin Yahoo! JAPAN Web Services Attribution Snippet -->
          <a href="https://developer.yahoo.co.jp/sitemap/">
            <img src="https://s.yimg.jp/images/yjdn/yjdn_attbtn1_125_17.gif" title="Webサービス by Yahoo! JAPAN"
              alt="Web Services by Yahoo! JAPAN" width="125" height="17" border="0"></a>
          <!-- End Yahoo! JAPAN Web Services Attribution Snippet -->
        </p>
      </section>
    </div>
  </div>
  <div class="card mt-3">
    <div class="card-body">
      <section>
        <h2 class="h5 card-title">現在地から近い医療機関を探す</h2>
        <p class="card-text mb-2">位置情報を使用して、現在地から近い新型コロナワクチン5～11歳接種医療機関の一覧を検索することができます。</p>
      </section>
      <section>
        <p id="gpsServiceStatus" class="none"></p>
      </section>
      <section id="nudge">
        <p><button id="useGps" class="btn btn-primary">現在地の位置情報を取得</button></p>
      </section>
      <section id="searchByGps">
        <form action="/child_reservation_statuses/search_by_gps" method="POST">
          <p>
          <input type="hidden" id="currentLatitude" name="current_latitude" value="">
          <input type="hidden" id="currentLongitude" name="current_longitude" value="">
          <button type="submit" id="sendCurrentLocation" class="btn btn-success">現在地から近い医療機関を検索</button>
          </p>
        </form>
      </section>
    </div>
  </div>
  <div class="card mt-3">
    <div class="card-body">
      <section>
        <h2 class="h5 card-title">地区から探す</h2>
        <p class="card-text">以下のリンクから地区ごとの新型コロナワクチン5～11歳接種医療機関の予約受付状況や地図を一覧で確認できます。</p>
        <div class="list-group-flush">
          {% for area in areas %}
          <a href="/child_reservation_status/area/{{ area.url }}" title="{{ area.name }}の新型コロナワクチン5～11歳接種医療機関一覧へ" class="list-group-item list-group-item-action text-primary">{{ area.name }}</a>
          {% endfor %}
        </div>
      </section>
    </div>
  </div>
  <div class="card mt-3">
    <div class="card-body">
      <section>
        <h2 class="h5 card-title">一覧から探す</h2>
        <p class="card-text">以下のリンクから新型コロナワクチン5～11歳接種医療機関ごとの予約受付状況や地図を確認できます。</p>
        <p class="card-text d-block d-sm-none"><i class="far fa-hand-point-right"></i> 横にスクロールできます。</p>
        <div class="table-responsive">
          <table class="table table-striped table-bordered table-sm small">
            <thead>
              <tr>
                <th class="text-nowrap">医療機関名</th>
                <th class="text-nowrap">予約受付状況</th>
                <th class="text-nowrap">住所</th>
              </tr>
            </thead>
            <tbody id="results" data-length="{{ search_lengths|tojson }}">
              {% for search_result in search_results %}
              <tr id="order{{ loop.index }}" data-latitude="{{ search_result.latitude|tojson }}" data-longitude="{{ search_result.longitude|tojson }}" data-name="{{ search_result.medical_institution_name|safe }}" data-url="{{ search_result.medical_institution_name_url|safe }}" data-vaccine="{{ search_result.vaccine|safe }}" data-status="{{ search_result.status|safe }}">
                <td class="text-nowrap"><a href="/child_reservation_status/medical_institution/{{ search_result.medical_institution_name_url }}" title="{{ search_result.medical_institution_name }}の予約受付状況へ">{{ search_result.medical_institution_name }}</a></td>
                <td class="text-nowrap">{{ search_result.status }}</td>
                <td class="text-nowrap">{{ search_result.address }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </section>
    </div>
  </div>
</article>
<script charset="utf-8" src="{{ url_for('static', filename='js/show_map_reservation.js') }}"></script>
<script charset="utf-8" src="{{ url_for('static', filename='js/get_gps.js') }}"></script>
{% endblock %}